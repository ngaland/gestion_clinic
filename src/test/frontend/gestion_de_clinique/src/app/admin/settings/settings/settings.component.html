<div class="settings-container">
  <!-- Header avec logo et déconnexion -->
  <app-header 
    pageTitle="Paramètres"
    pageSubtitle="Configuration de l'application">
  </app-header>

  <!-- Indicateur de chargement -->
  <div class="loading-container" *ngIf="loading">
    <div class="loading-spinner"></div>
    <p>Chargement des paramètres...</p>
  </div>

  <!-- Message d'erreur -->
  <div class="error-container" *ngIf="error && !loading">
    <div class="error-message">
      <span class="error-icon">⚠️</span>
      <span>{{ error }}</span>
      <button class="btn-retry" (click)="retryLoad()">🔄 Réessayer</button>
    </div>
  </div>

  <!-- Message de succès -->
  <div class="success-container" *ngIf="success">
    <div class="success-message">
      <span class="success-icon">✅</span>
      <span>{{ success }}</span>
    </div>
  </div>

  <!-- Contenu principal -->
  <div class="settings-content" *ngIf="!loading">
    
    <!-- Navigation par onglets -->
    <div class="settings-tabs">
      <button class="tab-button" 
              [class.active]="activeTab === 'profile'"
              (click)="setActiveTab('profile')">
        👤 Profil
      </button>
      <button class="tab-button" 
              [class.active]="activeTab === 'security'"
              (click)="setActiveTab('security')">
        🔒 Sécurité
      </button>
      <button class="tab-button" 
              [class.active]="activeTab === 'notifications'"
              (click)="setActiveTab('notifications')">
        🔔 Notifications
      </button>
      <button class="tab-button" 
              [class.active]="activeTab === 'system'"
              (click)="setActiveTab('system')">
        🏥 Système
      </button>
      <button class="tab-button" 
              [class.active]="activeTab === 'backup'"
              (click)="setActiveTab('backup')">
        💾 Sauvegarde
      </button>
      <button class="tab-button" 
              [class.active]="activeTab === 'theme'"
              (click)="setActiveTab('theme')">
        🎨 Thème
      </button>
    </div>

    <!-- Contenu des onglets -->
    <div class="tab-content">

      <!-- Onglet Profil -->
      <div class="tab-panel" *ngIf="activeTab === 'profile'">
        <div class="settings-section">
          <h2>👤 Informations du Profil</h2>
          <div class="form-group">
            <label>Nom d'utilisateur</label>
            <input type="text" [(ngModel)]="userProfile.username" disabled>
          </div>
          <div class="form-group">
            <label>Nom complet</label>
            <input type="text" [(ngModel)]="userProfile.fullName">
          </div>
          <div class="form-group">
            <label>Email</label>
            <input type="email" [(ngModel)]="userProfile.email">
          </div>
          <div class="form-group">
            <label>Rôle</label>
            <input type="text" [(ngModel)]="userProfile.role" disabled>
          </div>
          <div class="form-group">
            <label>Dernière connexion</label>
            <input type="text" [value]="userProfile.lastLogin" disabled>
          </div>
          <button class="btn-save" (click)="saveUserProfile()" [disabled]="loading">
            💾 Sauvegarder le profil
          </button>
        </div>

        <div class="settings-section">
          <h2>🔐 Changer le mot de passe</h2>
          <div class="form-group">
            <label>Mot de passe actuel</label>
            <input type="password" [(ngModel)]="passwordForm.currentPassword" placeholder="Entrez votre mot de passe actuel">
          </div>
          <div class="form-group">
            <label>Nouveau mot de passe</label>
            <input type="password" [(ngModel)]="passwordForm.newPassword" placeholder="Entrez le nouveau mot de passe">
          </div>
          <div class="form-group">
            <label>Confirmer le nouveau mot de passe</label>
            <input type="password" [(ngModel)]="passwordForm.confirmPassword" placeholder="Confirmez le nouveau mot de passe">
          </div>
          <button class="btn-save" (click)="changePassword()" [disabled]="loading">
            🔐 Changer le mot de passe
          </button>
        </div>
      </div>

      <!-- Onglet Sécurité -->
      <div class="tab-panel" *ngIf="activeTab === 'security'">
        <div class="settings-section">
          <h2>🔒 Paramètres de Sécurité</h2>
          <div class="form-group checkbox-group">
            <label>
              <input type="checkbox" [(ngModel)]="securitySettings.requirePasswordChange">
              Exiger le changement de mot de passe
            </label>
          </div>
          <div class="form-group">
            <label>Timeout de session (minutes)</label>
            <input type="number" [(ngModel)]="securitySettings.sessionTimeout" min="5" max="480">
          </div>
          <div class="form-group">
            <label>Nombre maximum de tentatives de connexion</label>
            <input type="number" [(ngModel)]="securitySettings.maxLoginAttempts" min="3" max="10">
          </div>
          <div class="form-group">
            <label>Expiration du mot de passe (jours)</label>
            <input type="number" [(ngModel)]="securitySettings.passwordExpiryDays" min="30" max="365">
          </div>
          <div class="form-group checkbox-group">
            <label>
              <input type="checkbox" [(ngModel)]="securitySettings.twoFactorEnabled">
              Activer l'authentification à deux facteurs
            </label>
          </div>
          <button class="btn-save" (click)="saveSecuritySettings()" [disabled]="loading">
            🔒 Sauvegarder les paramètres de sécurité
          </button>
        </div>
      </div>

      <!-- Onglet Notifications -->
      <div class="tab-panel" *ngIf="activeTab === 'notifications'">
        <div class="settings-section">
          <h2>🔔 Paramètres de Notification</h2>
          <div class="form-group checkbox-group">
            <label>
              <input type="checkbox" [(ngModel)]="notificationSettings.emailNotifications">
              Notifications par email
            </label>
          </div>
          <div class="form-group checkbox-group">
            <label>
              <input type="checkbox" [(ngModel)]="notificationSettings.smsNotifications">
              Notifications par SMS
            </label>
          </div>
          <div class="form-group checkbox-group">
            <label>
              <input type="checkbox" [(ngModel)]="notificationSettings.appointmentReminders">
              Rappels de rendez-vous
            </label>
          </div>
          <div class="form-group checkbox-group">
            <label>
              <input type="checkbox" [(ngModel)]="notificationSettings.systemAlerts">
              Alertes système
            </label>
          </div>
          <div class="form-group checkbox-group">
            <label>
              <input type="checkbox" [(ngModel)]="notificationSettings.marketingEmails">
              Emails marketing
            </label>
          </div>
          <button class="btn-save" (click)="saveNotificationSettings()" [disabled]="loading">
            🔔 Sauvegarder les paramètres de notification
          </button>
        </div>
      </div>

      <!-- Onglet Système -->
      <div class="tab-panel" *ngIf="activeTab === 'system'">
        <div class="settings-section">
          <h2>🏥 Paramètres de la Clinique</h2>
          <div class="form-group">
            <label>Nom de la clinique</label>
            <input type="text" [(ngModel)]="systemSettings.clinicName">
          </div>
          <div class="form-group">
            <label>Adresse</label>
            <textarea [(ngModel)]="systemSettings.clinicAddress" rows="3"></textarea>
          </div>
          <div class="form-group">
            <label>Téléphone</label>
            <input type="tel" [(ngModel)]="systemSettings.clinicPhone">
          </div>
          <div class="form-group">
            <label>Email de contact</label>
            <input type="email" [(ngModel)]="systemSettings.clinicEmail">
          </div>
        </div>

        <div class="settings-section">
          <h2>🌍 Paramètres Régionaux</h2>
          <div class="form-group">
            <label>Fuseau horaire</label>
            <select [(ngModel)]="systemSettings.timezone">
              <option value="Africa/Douala">Africa/Douala</option>
              <option value="Africa/Lagos">Africa/Lagos</option>
              <option value="Europe/Paris">Europe/Paris</option>
            </select>
          </div>
          <div class="form-group">
            <label>Langue</label>
            <select [(ngModel)]="systemSettings.language">
              <option value="fr">Français</option>
              <option value="en">English</option>
            </select>
          </div>
          <div class="form-group">
            <label>Devise</label>
            <select [(ngModel)]="systemSettings.currency">
              <option value="FCFA">FCFA</option>
              <option value="USD">USD</option>
              <option value="EUR">EUR</option>
            </select>
          </div>
          <div class="form-group">
            <label>Format de date</label>
            <select [(ngModel)]="systemSettings.dateFormat">
              <option value="DD/MM/YYYY">DD/MM/YYYY</option>
              <option value="MM/DD/YYYY">MM/DD/YYYY</option>
              <option value="YYYY-MM-DD">YYYY-MM-DD</option>
            </select>
          </div>
          <div class="form-group checkbox-group">
            <label>
              <input type="checkbox" [(ngModel)]="systemSettings.maintenanceMode">
              Mode maintenance
            </label>
          </div>
          <button class="btn-save" (click)="saveSystemSettings()" [disabled]="loading">
            🏥 Sauvegarder les paramètres système
          </button>
        </div>
      </div>

      <!-- Onglet Sauvegarde -->
      <div class="tab-panel" *ngIf="activeTab === 'backup'">
        <div class="settings-section">
          <h2>💾 Paramètres de Sauvegarde</h2>
          <div class="form-group checkbox-group">
            <label>
              <input type="checkbox" [(ngModel)]="backupSettings.autoBackup">
              Sauvegarde automatique
            </label>
          </div>
          <div class="form-group">
            <label>Fréquence de sauvegarde</label>
            <select [(ngModel)]="backupSettings.backupFrequency">
              <option value="daily">Quotidienne</option>
              <option value="weekly">Hebdomadaire</option>
              <option value="monthly">Mensuelle</option>
            </select>
          </div>
          <div class="form-group">
            <label>Rétention des sauvegardes (jours)</label>
            <input type="number" [(ngModel)]="backupSettings.backupRetention" min="7" max="365">
          </div>
          <div class="form-group">
            <label>Emplacement de sauvegarde</label>
            <input type="text" [(ngModel)]="backupSettings.backupLocation">
          </div>
          <div class="backup-info">
            <div class="info-item">
              <span class="info-label">Dernière sauvegarde:</span>
              <span class="info-value">{{ backupSettings.lastBackup }}</span>
            </div>
            <div class="info-item">
              <span class="info-label">Prochaine sauvegarde:</span>
              <span class="info-value">{{ backupSettings.nextBackup }}</span>
            </div>
          </div>
          <button class="btn-save" (click)="saveBackupSettings()" [disabled]="loading">
            💾 Sauvegarder les paramètres
          </button>
        </div>
      </div>

      <!-- Onglet Thème -->
      <div class="tab-panel" *ngIf="activeTab === 'theme'">
        <div class="settings-section">
          <h2>🎨 Paramètres de Thème</h2>
          <div class="form-group">
            <label>Couleur primaire</label>
            <input type="color" [(ngModel)]="themeSettings.primaryColor">
          </div>
          <div class="form-group">
            <label>Couleur secondaire</label>
            <input type="color" [(ngModel)]="themeSettings.secondaryColor">
          </div>
          <div class="form-group checkbox-group">
            <label>
              <input type="checkbox" [(ngModel)]="themeSettings.darkMode">
              Mode sombre
            </label>
          </div>
          <div class="form-group checkbox-group">
            <label>
              <input type="checkbox" [(ngModel)]="themeSettings.compactMode">
              Mode compact
            </label>
          </div>
          <button class="btn-save" (click)="saveThemeSettings()" [disabled]="loading">
            🎨 Sauvegarder les paramètres de thème
          </button>
        </div>
      </div>

    </div>

    <!-- Actions globales -->
    <div class="global-actions">
      <div class="action-buttons">
        <button class="btn-export" (click)="exportSettings()" [disabled]="loading">
          📥 Exporter les paramètres
        </button>
        <label class="btn-import">
          📤 Importer les paramètres
          <input type="file" (change)="onFileSelected($event)" accept=".json" style="display: none;">
        </label>
      </div>
    </div>
    
  </div>
</div>
